{% extends "layout.html" %}

{% block title %}Tutorías Inscritas{% endblock %}

{% block content %}
    <div class="formulario-grande">
        <h1>Tutorías en las que te has inscrito</h1>

        <!-- Mensajes flash -->
        <div id="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div>
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
            {% endwith %}
        </div>

        <!-- Barra de búsqueda -->
        <div class="box">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Buscar por espacio académico, día, hora o docente..." 
                onkeyup="filterInscripciones()" 
                class="search-box">
        </div>

        <!-- Tabla de inscripciones -->
        {% if inscripciones %}
        <div class="box">
            <table id="inscripcionTable">
                <thead>
                    <tr>
                        <th>Tutoría</th>
                        <th>Día</th>
                        <th>Hora</th>
                        <th>Docente</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inscripcion in inscripciones %}
                    <tr>
                        <td>{{ inscripcion.tutoria.espacio_academico }}</td>
                        <td>{{ inscripcion.horario.dia }}</td>
                        <td>{{ inscripcion.horario.hora }}</td>
                        <td>{{ inscripcion.tutoria.docente.nombre_completo }}</td>
                        <td>
                            <a href="{{ url_for('editar_inscripcion', inscripcion_id=inscripcion.id) }}" class="button">Editar</a>  
                            <a href="{{ url_for('eliminar_inscripcion', inscripcion_id=inscripcion.id) }}" class="button">Eliminar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="box">
            <p>No te has inscrito en ninguna tutoría.</p>
        </div>
        {% endif %}

        <!-- Botón para volver al Dashboard -->
        <div class="button-container">
            <a href="{{ url_for('dashboard') }}" class="button">Volver al Dashboard</a>
        </div>
    </div>

    <script>
        function filterInscripciones() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#inscripcionTable tbody tr');

            rows.forEach(row => {
                const espacioAcademico = row.cells[0].textContent.toLowerCase();
                const dia = row.cells[1].textContent.toLowerCase();
                const hora = row.cells[2].textContent.toLowerCase();
                const docente = row.cells[3].textContent.toLowerCase();

                if (espacioAcademico.includes(searchInput) || dia.includes(searchInput) || hora.includes(searchInput)
                    || docente.includes(searchInput)) {
                    row.style.display = ''; // Mostrar la fila
                } else {
                    row.style.display = 'none'; // Ocultar la fila
                }
            });
        }
    </script>
{% endblock %}
